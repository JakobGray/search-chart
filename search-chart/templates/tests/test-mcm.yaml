apiVersion: v1
kind: Pod
metadata:
  name: {{ template "ibm-mcm-search.fullname" . }}-test
  labels:
    app: {{ template "ibm-mcm-search.name" . }}
    chart: {{ template "ibm-mcm-search.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
  annotations:
    helm.sh/hook: "test-success"
spec:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: beta.kubernetes.io/arch
            operator: In
            values:
            {{- range .Values.global.arch }}
            - {{ . }}
            {{- end }}
  containers:
    - name: test
      image: "{{ .Values.kubectl.repository }}:{{ .Values.kubectl.tag }}"
      imagePullPolicy: "{{ .Values.kubectl.pullPolicy }}"
      securityContext:
        privileged: false
        readOnlyRootFilesystem: false
        allowPrivilegeEscalation: false
        runAsNonRoot: true
        runAsUser: 1000
        capabilities:
          drop:
          - ALL
      command:
        - kubectl
        - version
  {{- if .Values.global.pullSecret }}
  imagePullSecrets:
  - name: {{ .Values.global.pullSecret }}
  {{- end }}
  restartPolicy: Never
